<project name="dokuJClient" default="jar">
    <property name="lib.dir" value="/usr/share/java" />
    <property name="testresults.dir" value="testResults" />
    <path id="classpath">
       <pathelement location="${lib.dir}/ws-commons-util.jar" />
       <pathelement location="${lib.dir}/xmlrpc-client.jar" />
       <pathelement location="${lib.dir}/xmlrpc-common.jar" />
    </path>

    <target name="clean">
        <delete dir="bin"/>
        <delete dir="${testresults.dir}"/>
        <delete file="dokujclient.jar" />
    </target>

    <target name="compileClasses">
        <mkdir dir="bin"/>
        <javac srcdir="src" destdir="bin" excludesfile=".excludesfile" includeantruntime="false" classpathref="classpath" />
    </target>

    <target name="jar" depends="compileClasses">
      <jar destfile="dokujclient.jar" basedir="bin" excludesfile=".excludesfile" />
    </target>

    <target name="compileAll">
        <mkdir dir="bin"/>
        <javac srcdir="src" destdir="bin" includeantruntime="false">
          <classpath>
           <path refid="classpath" />
           <pathelement location="/usr/lib/eclipse/dropins/jdt/plugins/org.junit4/junit.jar" />
          </classpath>
        </javac>
        <jar destfile="dokujclient.tests.jar" basedir="bin" />
    </target>

    <target name="junit" depends="compileAll">
      <mkdir dir="${testresults.dir}" />

      <echo message="If tests fail, please make sure you've installed the fake wiki. See README for more information." />

      <!-- Use the following junit opening tag to have a more verbose run -->
      <!--junit printsummary="withOutAndErr" dir="src" haltonfailure="on"-->
      <junit printsummary="yes" dir="src" haltonfailure="on">
        <classpath>
          <path refid="classpath" />
          <pathelement location="dokujclient.tests.jar" />
          <pathelement location="${lib.dir}/junit4.jar" />
        </classpath>

        <formatter type="xml" />

        <batchtest fork="yes" todir="${testresults.dir}" >
          <fileset dir="src" includes="dw/xmlrpc/*test/T_*java" />
        </batchtest>
      </junit>
    </target>

    <target name="junitreport" depends="junit">
      <junitreport todir="${testresults.dir}">
        <fileset dir="${testresults.dir}" includes="TEST-*.xml"/>
        <report todir="${testresults.dir}"/>
      </junitreport>
      <echo message="Test results are available at ${testresults.dir}/index.html"/>
    </target>
</project>
